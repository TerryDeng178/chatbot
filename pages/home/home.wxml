<!-- ç¾¤èŠåˆ—è¡¨é¡µ - ä¸¥æ ¼æŒ‰ç…§V7åŸå‹è®¾è®¡ -->
<view class="container">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="header">
    <view class="header-title">ç¾¤èŠ</view>
  </view>

  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <view class="content">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading-container">
      <view class="loading-spinner"></view>
      <view class="loading-text">åŠ è½½ä¸­...</view>
    </view>

    <!-- é”™è¯¯çŠ¶æ€ -->
    <view wx:elif="{{!loading && groupList.length === 0 && hasError}}" class="error-state">
      <view class="error-icon">âš ï¸</view>
      <view class="error-text">åŠ è½½å¤±è´¥</view>
      <view class="error-subtext">ç½‘ç»œè¿æ¥å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®</view>
      <view class="retry-btn" bindtap="retryLoadGroups">é‡è¯•</view>
    </view>

    <!-- ç¾¤èŠåˆ—è¡¨ -->
    <scroll-view wx:elif="{{!loading && groupList.length > 0}}" scroll-y="true" class="group-list-container" refresher-enabled="true" bindrefresherrefresh="onPullDownRefresh">
      <view wx:for="{{groupList}}" wx:key="_id" class="card group-card" bindtap="navigateToGroup" data-group-id="{{item._id}}" data-group-name="{{item.name}}">
        <!-- ç¾¤èŠå¤´åƒ -->
        <view class="avatar group-avatar">
          <view class="avatar-icon">{{item.topic === 'emotion-support' ? 'ğŸ’•' : item.topic === 'workplace-relax' ? 'ğŸ’¼' : item.topic === 'night-chat' ? 'ğŸŒ™' : item.topic === 'creative-ideas' ? 'âœ¨' : item.topic === 'study-help' ? 'ğŸ“š' : 'ğŸ’¬'}}</view>
        </view>
        
        <!-- ç¾¤èŠä¿¡æ¯ -->
        <view class="group-info">
          <view class="group-header">
            <view class="group-title">{{item.name}}</view>
            <view wx:if="{{item.isPreset}}" class="preset-badge">å®˜æ–¹</view>
          </view>
          <view class="group-description">{{item.description}}</view>
          <view class="group-meta">
            <view class="group-members">{{item.memberCount}}äºº</view>
            <view class="group-last-message">{{item.lastMessage}}</view>
          </view>
        </view>
        
        <!-- å³ä¾§ä¿¡æ¯ -->
        <view class="group-right">
          <view class="group-time">{{item.lastActiveAt}}</view>
          <view wx:if="{{item.unreadCount > 0}}" class="unread-badge">{{item.unreadCount}}</view>
        </view>
      </view>
    </scroll-view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:elif="{{!loading && groupList.length === 0 && !hasError}}" class="empty-state">
      <view class="empty-icon">ğŸ’¬</view>
      <view class="empty-text">è¿˜æ²¡æœ‰ç¾¤èŠ</view>
      <view class="empty-subtext">ç‚¹å‡»å³ä¸‹è§’ + åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªç¾¤èŠ</view>
    </view>
  </view>

  <!-- æµ®åŠ¨æ“ä½œæŒ‰é’® - åœ†å½¢ï¼Œå“ç‰Œç´« -->
  <view class="add-group-btn" bindtap="showCreateGroupModal">
    <view class="add-icon">+</view>
  </view>

  <!-- åˆ›å»ºç¾¤èŠå¼¹çª— -->
  <view wx:if="{{showCreateModal}}" class="modal-overlay" bindtap="hideCreateGroupModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <view class="modal-title">åˆ›å»ºç¾¤èŠ</view>
        <view class="modal-close" bindtap="hideCreateGroupModal">Ã—</view>
      </view>
      
      <view class="modal-body">
        <view class="form-item">
          <view class="form-label">ç¾¤èŠåç§°</view>
          <input class="form-input" placeholder="è¯·è¾“å…¥ç¾¤èŠåç§°" value="{{newGroupName}}" bindinput="onGroupNameInput" />
        </view>
        
        <view class="form-item">
          <view class="form-label">ç¾¤èŠä¸»é¢˜</view>
          <input class="form-input" placeholder="è¯·è¾“å…¥ç¾¤èŠä¸»é¢˜" value="{{newGroupTopic}}" bindinput="onGroupTopicInput" />
        </view>
        
        <view class="form-item">
          <view class="form-label">ç¾¤èŠæè¿°</view>
          <textarea class="form-textarea" placeholder="è¯·è¾“å…¥ç¾¤èŠæè¿°ï¼ˆå¯é€‰ï¼‰" value="{{newGroupDescription}}" bindinput="onGroupDescriptionInput" />
        </view>
      </view>
      
      <view class="modal-footer">
        <view class="btn btn-cancel" bindtap="hideCreateGroupModal">å–æ¶ˆ</view>
        <view class="btn btn-confirm" bindtap="createGroup">åˆ›å»º</view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ ‡ç­¾æ  - V7åŸå‹ï¼šä¸‰ä¸ªä¸»å¯¼èˆªï¼ˆå¯¹è¯/è§’è‰²/è®¾ç½®ï¼‰ -->
  <view class="bottom-tab-bar">
    <view class="tab-item active">
      <view class="tab-icon">ğŸ’¬</view>
      <view class="tab-text">å¯¹è¯</view>
    </view>
    <view class="tab-item" bindtap="navigateToRoles">
      <view class="tab-icon">ğŸ¤–</view>
      <view class="tab-text">è§’è‰²</view>
    </view>
    <view class="tab-item" bindtap="navigateToSettings">
      <view class="tab-icon">âš™ï¸</view>
      <view class="tab-text">è®¾ç½®</view>
    </view>
  </view>
</view>