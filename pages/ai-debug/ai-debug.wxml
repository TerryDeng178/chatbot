<!--pages/ai-debug/ai-debug.wxml-->
<view class="container">
  <view class="header">
    <text class="title">ğŸ¤– AIé—®é¢˜è¯Šæ–­å·¥å…·</text>
    <text class="subtitle">å…¨é¢è¯Šæ–­AIç³»ç»Ÿé—®é¢˜å¹¶è‡ªåŠ¨ä¿®å¤</text>
  </view>

  <!-- è¯Šæ–­æ“ä½œåŒºåŸŸ -->
  <view class="action-section">
    <button 
      class="debug-btn {{isRunning ? 'running' : ''}}"
      bindtap="startAIDebug"
      disabled="{{isRunning}}"
    >
      <text wx:if="{{!isRunning}}">ğŸ” å¼€å§‹è¯Šæ–­</text>
      <text wx:else>â³ è¯Šæ–­ä¸­...</text>
    </button>
    
    <button 
      class="test-btn"
      bindtap="retestAIFunction"
      disabled="{{isRunning}}"
    >
      ğŸ§ª æµ‹è¯•AIåŠŸèƒ½
    </button>
  </view>

  <!-- è¯Šæ–­ç»“æœåŒºåŸŸ -->
  <view class="result-section" wx:if="{{debugResult}}">
    <view class="result-header">
      <text class="result-title">ğŸ“Š è¯Šæ–­ç»“æœ</text>
      <button class="copy-btn" bindtap="copyDebugResult">ğŸ“‹ å¤åˆ¶</button>
    </view>
    
    <view class="result-content">
      <view class="status-item">
        <text class="status-label">æ•´ä½“çŠ¶æ€:</text>
        <text class="status-value {{debugResult.overallStatus}}">
          {{debugResult.overallStatus === 'healthy' ? 'âœ… æ­£å¸¸' : 
            debugResult.overallStatus === 'needs_data' ? 'âš ï¸ éœ€è¦æ•°æ®' :
            debugResult.overallStatus === 'missing_collection' ? 'âŒ é›†åˆç¼ºå¤±' :
            debugResult.overallStatus === 'environment_error' ? 'ğŸš¨ ç¯å¢ƒé”™è¯¯' : 'â“ æœªçŸ¥'}}
        </text>
      </view>
      
      <view class="issue-item">
        <text class="issue-label">ä¸»è¦é—®é¢˜:</text>
        <text class="issue-value">{{debugResult.mainIssue}}</text>
      </view>
      
      <view class="recommendations-item">
        <text class="recommendations-label">ä¿®å¤å»ºè®®:</text>
        <view class="recommendations-list">
          <text wx:for="{{debugResult.recommendations}}" wx:key="index" class="recommendation-item">
            {{item}}
          </text>
        </view>
      </view>
    </view>
  </view>

  <!-- å†å²è®°å½•åŒºåŸŸ -->
  <view class="history-section">
    <view class="history-header">
      <text class="history-title">ğŸ“ è¯Šæ–­å†å²</text>
      <view class="history-actions">
        <button class="toggle-btn" bindtap="toggleHistory">
          {{showHistory ? 'éšè—' : 'æ˜¾ç¤º'}}
        </button>
        <button class="clear-btn" bindtap="clearHistory" wx:if="{{debugHistory.length > 0}}">
          æ¸…ç©º
        </button>
      </view>
    </view>
    
    <view class="history-content" wx:if="{{showHistory}}">
      <view wx:if="{{debugHistory.length === 0}}" class="empty-history">
        <text>æš‚æ— è¯Šæ–­è®°å½•</text>
      </view>
      
      <view wx:else class="history-list">
        <view 
          wx:for="{{debugHistory}}" 
          wx:key="id" 
          class="history-item"
          bindtap="viewHistoryDetail"
          data-index="{{index}}"
        >
          <view class="history-time">{{item.timestamp}}</view>
          <view class="history-status">
            <text class="status-badge {{item.result.overallStatus}}">
              {{item.result.overallStatus === 'healthy' ? 'æ­£å¸¸' : 
                item.result.overallStatus === 'needs_data' ? 'éœ€ä¿®å¤' :
                item.result.overallStatus === 'missing_collection' ? 'ç¼ºå¤±' :
                item.result.overallStatus === 'environment_error' ? 'é”™è¯¯' : 'æœªçŸ¥'}}
            </text>
          </view>
          <view class="history-issue">{{item.result.mainIssue}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- ä½¿ç”¨è¯´æ˜ -->
  <view class="help-section">
    <view class="help-header">
      <text class="help-title">ğŸ’¡ ä½¿ç”¨è¯´æ˜</text>
    </view>
    <view class="help-content">
      <text class="help-text">1. ç‚¹å‡»"å¼€å§‹è¯Šæ–­"è¿›è¡Œå…¨é¢AIç³»ç»Ÿæ£€æŸ¥</text>
      <text class="help-text">2. ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä¿®å¤å¸¸è§é—®é¢˜</text>
      <text class="help-text">3. è¯Šæ–­å®Œæˆåå¯æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š</text>
      <text class="help-text">4. ä½¿ç”¨"æµ‹è¯•AIåŠŸèƒ½"éªŒè¯ä¿®å¤æ•ˆæœ</text>
    </view>
  </view>
</view>
