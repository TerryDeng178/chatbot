<!-- èŠå¤©ç•Œé¢é¡µ - ä¸¥æ ¼æŒ‰ç…§V7åŸå‹è®¾è®¡ -->
<view class="chat-container">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="header">
    <view class="header-content">
      <view class="back-btn" bindtap="goBack">
        <view class="back-icon">â†</view>
      </view>
      <view class="header-title">{{currentCharacter.name || 'å¿ƒçµå¯¼å¸ˆæ¸©æƒ…'}}</view>
    </view>
  </view>

  <!-- èŠå¤©å¤´éƒ¨ä¿¡æ¯ - æŒ‰ç…§V7è®¾è®¡ -->
  <view class="chat-header">
    <view class="chat-header-content">
      <view class="character-avatar">
        <view class="character-icon">ğŸ¤–</view>
      </view>
      <view class="character-info">
        <view class="character-name">{{currentCharacter.name || 'å¿ƒçµå¯¼å¸ˆæ¸©æƒ…'}}</view>
        <view class="character-status">åœ¨çº¿ Â· çŸ¥è¯†ä¸°å¯Œ Â· å…±æƒ…åŠ›å¼º</view>
      </view>
    </view>
  </view>

  <!-- æ¶ˆæ¯åŒºåŸŸ -->
  <scroll-view class="message-area" scroll-y="true" scroll-top="{{scrollTop}}" scroll-into-view="{{toView}}">
    <view class="messages-content">
      <block wx:for="{{messages}}" wx:key="id">
        <!-- AIæ¶ˆæ¯ -->
        <view class="message-container ai-msg" wx:if="{{item.role === 'assistant'}}">
          <view class="message-wrapper">
            <view class="ai-message-row">
              <view class="ai-avatar-small">
                <view class="ai-icon">ğŸ¤–</view>
              </view>
              <view class="message-bubble ai-bubble">
                {{item.content}}
              </view>
            </view>
            <view class="message-time ai-time">{{item.time}}</view>
          </view>
        </view>
        
        <!-- ç”¨æˆ·æ¶ˆæ¯ -->
        <view class="message-container user-msg" wx:else>
          <view class="message-wrapper user-wrapper">
            <view class="user-message-row">
              <view class="message-bubble user-bubble">
                {{item.content}}
              </view>
              <view class="user-avatar-small">
                <view class="user-icon">ğŸ‘¤</view>
              </view>
            </view>
            <view class="message-time user-time">{{item.time}}</view>
          </view>
        </view>
      </block>
      
      <!-- åŠ è½½ä¸­çŠ¶æ€ -->
      <view class="message-container ai-msg" wx:if="{{isLoading}}">
        <view class="message-wrapper">
          <view class="ai-message-row">
            <view class="ai-avatar-small">
              <view class="loading-icon">ğŸ¤–</view>
            </view>
            <view class="message-bubble ai-bubble loading-bubble">
              <view class="typing-indicator">
                <view class="dot"></view>
                <view class="dot"></view>
                <view class="dot"></view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨è¾“å…¥åŒºåŸŸ - ä¸¥æ ¼æŒ‰ç…§V7è®¾è®¡ -->
  <view class="chat-footer">
    <view class="input-box">
      <view class="emoji-btn">ğŸ˜Š</view>
      <input 
        class="message-input" 
        type="text" 
        placeholder="è¾“å…¥æƒ³è¦å€¾è¯‰çš„å†…å®¹..." 
        value="{{inputText}}"
        bindinput="onInputChange"
        confirm-type="send"
        bindconfirm="sendMessage"
      />
    </view>
    <view class="send-btn {{inputText ? 'active' : ''}}" bindtap="sendMessage">
      <view class="send-icon">â¤</view>
    </view>
  </view>
</view>