# 多AI群聊功能完整指南

## 🎯 功能概述

现在您的群聊支持动态管理多个AI角色了！您可以：
- 在群聊中添加新的AI角色
- 从群聊中移除不需要的AI角色
- 实时切换AI的激活状态
- 享受最多5个AI同时参与的群聊体验

## 🚀 新增功能

### 1. 添加AI到群聊
- 点击AI选择器中的"添加新AI"按钮
- 选择要添加的AI角色
- AI将自动加入群聊并发送欢迎消息

### 2. 移除AI从群聊
- 在多AI选择器中点击已激活的AI
- AI将自动离开群聊并发送告别消息

### 3. 系统消息通知
- 当AI加入/离开群聊时，系统会自动发送通知消息
- 系统消息使用特殊的橙色样式，易于识别

## 📱 使用方法

### 添加AI到群聊
1. 在群聊页面顶部，点击AI选择器按钮
2. 点击"添加新AI"按钮
3. 在弹出的选择器中选择要添加的AI
4. 确认添加，AI将自动加入群聊

### 管理群聊中的AI
1. 点击多AI选择器按钮（显示当前激活AI数量）
2. 在列表中选择要激活/停用的AI
3. 点击AI项目即可切换其状态
4. 最多可同时激活5个AI

### 查看AI状态
- 顶部导航栏显示当前选中的AI
- 多AI模式按钮显示是否启用多AI功能
- 多AI选择器显示当前激活的AI数量

## 🎨 界面设计

### 添加AI选择器
- 现代化卡片式设计
- 显示可添加的AI列表
- 每个AI项目包含头像、昵称、性格和描述
- 添加按钮使用渐变色彩，视觉效果突出

### 系统消息样式
- 使用橙色主题色彩
- 居中显示，易于识别
- 包含系统图标（🔔）
- 圆角气泡设计，与整体风格一致

## 🔧 技术实现

### 前端功能
- `addNewAIToGroup()`: 显示可添加的AI列表
- `showAddAISelector()`: 显示添加AI选择器
- `selectAIToAdd()`: 处理AI添加逻辑
- `selectActiveAI()`: 处理AI激活/停用逻辑
- `sendSystemMessage()`: 发送系统消息

### 后端功能
- `manageGroupAIs()`: 管理群聊AI配置
- `getAIInfo()`: 获取AI详细信息
- 支持添加(`add`)和移除(`remove`)操作
- 自动发送系统消息通知

### 数据库更新
- 群聊表(`Groups`)记录当前激活的AI列表
- 消息表(`Messages`)支持系统消息类型
- 实时同步AI状态变化

## 📊 支持的AI角色

| ID | 昵称 | 性格类型 | 专长领域 | 头像 |
|----|------|----------|----------|------|
| 1 | 心灵导师温情 | 温暖关怀型 | 心理咨询、情绪支持 | 💖 |
| 2 | 知识助手小博 | 博学专业型 | 知识问答、学习指导 | 📚 |
| 3 | 创意伙伴小艺 | 创意活泼型 | 创意激发、艺术讨论 | 🎨 |
| 4 | 商务顾问小商 | 商务专业型 | 商务咨询、职场建议 | 💼 |
| 5 | 技术专家小码 | 技术专家型 | 技术咨询、编程指导 | 💻 |
| 6 | 幽默大师小幽 | 幽默风趣型 | 幽默调节、气氛营造 | 😄 |
| 7 | 文艺诗人小诗 | 文艺诗意型 | 文学讨论、诗歌创作 | 🌸 |
| 8 | 智慧长者小智 | 智慧长者型 | 人生哲理、深度思考 | 🧠 |

## 🚦 使用限制

- 每个群聊最多同时激活5个AI
- 添加AI需要网络连接正常
- 移除AI会立即生效，无需确认
- 系统消息会自动保存到聊天记录

## 🔍 故障排除

### 常见问题
1. **无法添加AI**: 检查是否已达到5个AI限制
2. **AI添加失败**: 检查网络连接和云函数状态
3. **系统消息不显示**: 刷新页面或重新进入群聊

### 调试方法
1. 查看浏览器控制台日志
2. 检查云函数执行日志
3. 验证数据库权限设置

## 🎉 更新日志

### v2.1.0 (当前版本)
- ✅ 新增添加AI到群聊功能
- ✅ 新增移除AI从群聊功能
- ✅ 新增系统消息通知
- ✅ 优化多AI管理界面
- ✅ 完善错误处理机制

### v2.0.0
- ✅ 基础多AI群聊功能
- ✅ 8种预设AI性格
- ✅ AI智能调度算法
- ✅ 多AI模式切换

## 🔮 未来计划

- [ ] 支持自定义AI性格
- [ ] 支持AI性格组合使用
- [ ] 支持AI性格学习和进化
- [ ] 支持AI性格偏好设置
- [ ] 支持AI性格统计分析
- [ ] 支持AI角色权限管理

## 📞 技术支持

如果您在使用过程中遇到问题，请：
1. 查看本文档的故障排除部分
2. 检查云函数日志
3. 联系开发团队获取帮助

---

**享受您的多AI群聊体验！** 🎊
