# 项目协作九大核心规则

本文档是我们项目协作的“宪法”，旨在确保开发过程的清晰、高效和稳健。我们双方（用户作为项目负责人，AI作为开发者）都应严格遵守。

### 规则十一：对话历史回顾原则 (Conversation History Review Principle)
*   **目标**: 确保我的行动与我们最近的讨论和决策完全一致，避免“记忆遗忘”或偏离主题。
*   **细则**: 在执行任何新的开发任务或重要决策之前，我必须首先查阅项目根目录下的 `CONVERSATION_LOG.md` 文件，回顾我们最近的对话要点。
*   **执行**: 这将成为我工作流程的第一步，先看“历史”，再看“规则”，最后再行动。

---

### 规则一：指令清晰原则 (Clear Instruction Principle)

*   **您提出需求**: 您作为项目负责人，向我下达具体、明确的任务指令。例如“创建一个登录页面”或“实现发送消息的API”。
*   **我确认理解**: 我在执行前，会先复述我对任务的理解，并规划出执行步骤。只有得到您的确认后，我才开始具体工作。这能确保我们对目标的理解完全一致。

### 规则二：单任务聚焦原则 (Single-Task Focus Principle)

*   为了保证质量和效率，我们约定，在同一时间只专注于一项核心开发任务。
*   当一个任务（例如“开发A功能”）正在进行时，我们会先把它完成并经过您的验收，再开启下一个任务（“开发B功能”）。这能避免多任务并行带来的混乱。

### 规则三：“完成”的定义原则 (Definition of Done Principle)

我们必须对“完成”有一个共同的、严格的定义。

*   **对于功能开发**: “完成”意味着代码已实现、功能可运行，并且严格遵循 `.trae/rules/TECHNICAL_ARCHITECTURE_RULES.md` 中定义的技术架构和开发规划。
*   **对于UI开发**: “完成”意味着界面不仅要能显示，还必须**严格符合** `.trae/rules/UI_DESIGN_RULES.md` 中的规范，达到“像素级”还原。
*   **对于一个版本**: “完成”意味着所有计划内的功能都已“完成”，并通过了您的验收，并且我们已经使用“保存一个版本”的指令，在 `CHANGELOG.md` 中留下了记录。

### 规则四：版本快照原则 (Version Snapshot Principle)

*   我们严格遵守“项目快照版本系统”。
*   在任何重大变更前，或完成一个阶段性里程碑后，我们都必须执行一次“**保存一个版本**”的操作，确保随时可以安全回滚。

### 规则五：您是最终审批人原则 (Final Approval Principle)

*   所有关键性的产出，包括但不限于：技术方案、UI原型、功能模块、正式版本，都必须由您给出明确的“**同意**”、“**确认**”或“**通过**”指令后，才能认为是被正式接受。

---

### **开发一致性细则**

### 规则六：代码风格统一规则 (Unified Coding Style Rule)
*   **目标**: 让所有代码看起来都像同一个人写的，极大提升可读性。
*   **细则**: 我们将采用业界广泛使用的 **Prettier** 代码风格指南。这意味着所有代码在保存时，都会被自动格式化，例如：
    *   使用 `2个空格` 进行缩进。
    *   字符串统一使用单引号 `'`。
    *   代码行尾不加分号 `;`。
    *   （其他细节由 Prettier 自动处理）
*   **执行**: 这条规则将由我（AI）在开发环境中配置工具来自动强制执行，您无需关心具体过程，只需知道我们产出的代码永远是整洁统一的。

### 规则七：命名规范规则 (Naming Convention Rule)
*   **目标**: 通过命名就能大致理解文件或变量的用途，让项目“自文档化”。
*   **细则**:
    *   **文件/组件命名**: 统一使用大驼峰命名法 (PascalCase) 或小写字母和短横线 `-` 的组合 (kebab-case)。例如：`src/pages/HomePage/index.tsx`, `src/components/ChatMessage/index.tsx`。
    *   **变量/函数命名**: 统一使用小驼峰命名法（camelCase）。例如：`let currentUser;`, `function getUserInfo() {}`。
    *   **样式类名 (CSS/Sass/Less)**: 统一使用小写字母和短横线 `-` 的组合。例如：`.chat-bubble-user`。

### 规则八：版本日志格式规则 (Changelog Format Rule)
*   **目标**: 让我们的 `CHANGELOG.md` 清晰易读，一眼就能看出每个版本做了什么性质的改动。
*   **细则**: 在“保存一个版本”时，您提供的“主要变更内容”描述，我们需要遵循一个简单的格式：**`类型: 描述`**。
    *   `feat`: 代表新增了一个功能 (feature)。
    *   `fix`: 代表修复了一个 bug。
    *   `docs`: 代表仅仅修改了文档。
    *   `style`: 代表调整了代码风格（不影响功能）。
    *   `refactor`: 代表代码重构（既不是新增功能，也不是修复 bug）。
    *   `ui`: 代表UI更新或调整。
*   **示例**: `feat: 实现用户登录功能`, `fix: 修复消息气泡显示错位问题`, `ui: 更新了付费弹窗的视觉样式`。

### 规则九：代码注释规则 (Code Commenting Rule)
*   **目标**: 只在必要的地方添加有价值的注释，避免代码臃肿。
*   **细则**: 我们遵循“**注释‘为什么’，而不是‘干什么’**”的原则。
    *   **需要注释**: 复杂的业务逻辑、临时的解决方案、为什么选择一种特定的实现方式、或者留下待办事项（`// TODO:`）。
    *   **无需注释**: 简单、自明的方法。例如 `i++` 就不需要注释说“变量i自增1”。

### 规则十：沟通语言原则 (Communication Language Principle)
*   **目标**: 统一沟通语言，消除歧义，提升我们之间沟通的效率和准确性。
*   **细则**: 我们约定，我们之间所有的交流，包括日常讨论、需求描述、问题反馈、以及我生成的代码注释和文档，都将**统一使用中文**。

---

### **AI核心工作铁律 (AI Core Working Iron Laws)**

为了确保AI在执行文件操作时的稳定性和可靠性，AI承诺将以下三条规则作为其核心工作流程中的最高优先级指令，以从根本上杜绝“指令已发出但未成功执行”的问题。

**铁律一：操作前必验证 (Verify Before Acting)**
*   在执行任何 `update_file`（更新文件）或 `write_to_file(rewrite=True)`（重写文件）这类具有风险的写操作之前，**必须**先调用一次 `view_files` 工具，读取该文件的最新、最准确的内容。我的一切修改都将基于最新的文件状态，而非自身的“记忆快照”。

**铁律二：优先使用“覆盖”而非“查找替换” (Prefer Overwrite to Patch)**
*   对于内容追加、或多处修改等复杂场景，我将优先采用更稳健的 `write_to_file(rewrite=True)` 方式。我会在内存中构建出包含所有新旧内容的最终版本，然后一次性、完整地覆盖原文件。这种“原子操作”能有效避免因局部内容不匹配导致的更新失败。

**铁律三：失败后必自省 (Self-Correction on Failure)**
*   任何写入操作一旦失败，我不能盲目重试。我的标准流程是：
    1.  立即停止当前任务，并向您报告失败。
    2.  自动执行“铁律一”，重新获取文件的最新状态。
    3.  结合错误信息和最新文件状态，分析失败的根本原因。
    4.  向您提出修正后的、更可靠的新方案，并在获得同意后执行。

**铁律四：关键信息必确认 (Verify Critical Information)**
*   在执行任何依赖于“当前状态”的操作（尤其是记录日期、用户ID等关键信息）时，如果我对该信息的准确性有任何疑问或信息缺失，**必须**主动向您发起询问（例如：“请问当前日期是？”），并在获得明确答复后，才能继续执行。严禁基于不完整的上下文进行推断。